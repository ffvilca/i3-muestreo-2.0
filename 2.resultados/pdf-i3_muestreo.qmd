---
title: "Interrogación 3"
subtitle: "EYP2417 - Muestreo"
format: 
  pdf: 
    include-in-header: 
      text: |
        \usepackage{amsmath}
        \usepackage{float}
    colorlinks: true
    geometry:
      - top=20mm
      - left=20mm
      - right=20mm
      - heightrounded
    fig-pos: "H"
author: 
  - name: "Camila Echeverría"
  - name: "Francisca Vilca"
crossref:
  fig-title: Figura
  fig-prefix: Figura
  tbl-title: Tabla
  tbl-prefix: Tabla
tbl-cap-location: bottom
---

```{r setup, include=FALSE}

library(survey)
library(tidyverse)
library(anesrake)
library(expss)
library(kableExtra)
library(beepr)
library(here)

```

```{r cache=TRUE, include=FALSE}
source(here("2.resultados/script-i3_muestreo.R"), local = knitr::knit_global())
```


# Análisis de la elección presidencial del año 2021

En el siguiente informe, se darán a conocer algunos resultados interesantes, con respecto a las elecciones presidenciales del año 2021, se analizará al votante de 1ra Vuelta con respecto a sus características como el Sexo, Edad y GSE, además se intentarán proyectar los resultados de 2da Vuelta, para ellos se usarán diferentes técnicas de muestreo y de balanceo para que los resultados sean lo más verosimiles a la realidad.

## Diseño Muestral

En este caso se realizará un muestreo de conglomerados en dos etapas, estratificadas por zona (considera solo viviendas urbanas – censo 2017). Primeramente, se obtiene una muestra aleatoria simple de manzanas al interior de cada estrato y de cada manzana se obtiene una muestra aleatoria de viviendas. Al interior de cada vivienda se selecciona un elector según la técnica del “cumpleaños”. No se realiza actualización del número de viviendas de la manzana seleccionada, de aquí son seleccionadas `r nrow(datos)` personas de un total de `r Pobla_Chile`.

## Probabilidades de Selección y Factores de Expansión según Zona, Sexo y cat-Edad de acuerdo al diseño Muestral

Por un lado si se usa la información del censo realizado el 2017, es posible obtener la información de las manzanas y las viviendas totales para calcular las probabilidades de selección, por otro lado, si se usan las estimaciones y proyecciones de la población que se tienen para el 2021, es posible conocer la cantidad de personas por sexo y edad que habrá en Chile y usando la tabla 1 de las referencias, se puede conocer los GSE que existen al 2021.

Con toda esta información se tiene que las probabilidades de selección y factores de Expansión serán:

```{r echo = FALSE, fig.cap="Tabla 1: Probabilidades de Selección y Factores de Expansión según Zona, Sexo y cat-edad"}
#|tbl-cap: Probabilidades de Selección y Factores de Expansión según Zona, Sexo y cat-edad

tabla_datos1 <- cbind(muestra[,1:3],prob,fexp)

colnames(tabla_datos1) <- c("zona","sexo","cat.edad","Prob de Selección","Factores de Expansión")

knitr::kable(tabla_datos1, digits = 6, align = "c")
```

## Cruce de votos 2da Vuelta vs 1ra Vuelta de la muestra sin ponderar

Para este caso, en general solo es de interés ver la redistribución de los votos tal y como es lo expresado por los ciudadanos de la muestra, los resultados pueden ser apreciados en la Tabla 2:

```{r echo = FALSE, fig.cap="Tabla 2: Cruce de votos 2da Vuelta vs 1ra Vuelta de la muestra sin ponderar"}

tabla_datos2 <- cro_cpct(datos$P2v, datos$P1v)

tabla_datos2[is.na(tabla_datos2)] = 0

tabla_datos2 <- tabla_datos2[,2:11]

colnames(tabla_datos2) <- c("Boric", "Kast", "Provoste","Sichel", "Ártes", "Enriquez", "Parisi", "No vote", "Blanco \n /Nulo","No sabe")
row.names(tabla_datos2) <- c("Boric", "Kast","Nulo", "No Votaré","No sabe","Total \n de casos")

knitr::kable(tabla_datos2, digits = 3)
```

## Cruce de votos 2da Vuelta vs 1ra Vuelta de la muestra con ponderación

En la misma línea del item anterior, ahora se hará el cruce de votos pero haciendo una ponderación según 

a) Obtenga las respectivas probabilidades de selección y los factores de expansión según Zona, sexo y cat.Edad de acuerdo con el diseño muestral. Contraste los resultados obtenidos con la información censal proyectada al año 2021. Para esta base, muestre el cruce voto 2da vuelta (`P2v`) vs 1era vuelta (`P1v`) ponderado y sin ponderar – en términos de porcentaje tal que permita leer la re-distribución de los votos. Comente los aspectos más llamativos, por ej. ¿Dónde van los votos de Parisi? (un párrafo). **(1.0 punto)**


b) Para la base ponderada, obtenga los g-weigths (%pob / %muestral) según zona y sexo–cat.edad. Para esta base, muestre el cruce voto 2da vuelta (`P2v`) vs 1era vuelta (`P1v`) – en términos de porcentaje tal que permita leer la re-distribución de los votos. Comente los aspectos más llamativos, por ej. ¿Dónde van los votos de Parisi? (un párrafo).**(1.0 punto)**

c) Para la base sin ponderar, usando la distribución GSE según zona, más la proyección censal realice un rastrillado (raking) según **zona – sexo – cat.edad – GSE** (total) que le permita 
obtener una nueva ponderación. Reproduzca los cruces de b) y contraste con lo obtenido previamente y comente (un párrafo). **(1.0 punto)**

d) Literalmente, hasta el momento se trabaja con el supuesto de cómo se comportarán los poco más de 15 millones de chilenos. Sin embargo, hubo una abstención importante y se pueden ver discrepancias entre los resultados de la elección en 1era vuelta y los valores obtenidos en la encuesta (P1v). Realice un rastrillado que considere estos resultados. Es decir, lleve a cabo un “raking” según **zona – sexo – cat.edad – Voto** (total ver tabla). Reproduzca los cruces de b) y contraste con lo obtenido previamente y comente (un párrafo). **(1.0 punto)**

e) Considerando todos los resultados previos, realice predicciones para Total Poblacional (15.200.840), de tal manera que muestre el número de votos de cada candidato bajo cada ponderador (a, b, c y d). Comente (un párrafo). **(2.0 puntos)**

```{r include=FALSE}
beep()
```

